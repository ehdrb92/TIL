# 1차 프로젝트 2일차

## Standing meeting

오전에 각 인원별로 개발 진행상황과 에로사항에 대해 간단하게 이야기하는 시간을 가졌다. 아직 2일차라서 큰 진행상황은 없었고, 애로사항 또한 크게 없었다.

## 데이터베이스 모델링 리뷰

1차 스프린트에서 진행할 데이터베이스를 전체적으로 구상해 본 것을 멘토님과 함께 리뷰해보는 과정을 가졌다.

전체적인 큰 그림에서는 에로사항이 없었다. 하지만 테이블명, 변수명 등 사소한 부분에서 수정해야 할 사항들이 많이 보였다.  
앞으로 모델링을 할 때 꼼꼼히 확인하는 습관을 가지도록 해야겠다.

그리고 참고용으로 일반적인 커머스사이트의 데이터베이스 ERD 예시를 받았다.  
해당 데이터베이스 ERD를 바탕으로 기존의 관계 방식을 수정하였다.

## Restful API??

오늘 사이트 데이터 전송을 위한 로직을 만드는 중 에로사항이 발생했다. 기존의 클론을 하려는 사이트는 상품의 카테고리가 변경되거나 상품 페이지가 변경될 때 엔드포인트의 숫자가 변하면서 데이터 변경이 생기는 점을 알 수 있었다. 그러면 내 생각에는 URL의 엔드포인트가 변함에 따라 해당 정보를 매개변수로 받아서 다른 데이터를 전송하도록 하는 view 로직을 구성해야 한다고 생각하였다. 하지만 아직은 해당 사항에 배우지 않아 어떻게 이를 구조화 할 지 몰랐다.

그래서 구현 방법에 대해 찾아볼려고 하였는데, 내일 이에 대해 배우는 세션이 있었다. 그리고 이 로직을 구성하기 전 먼저 해야 할 일이 많아 일단은 내일 세션을 가진 후 하는 편이 좋지 않을 까 생각이 들어 일단 미뤄두었다.

## Foreign Key의 참조방식

기존에 주문 테이블에서 유저 테이블을 참조할 때, `on_delete=CASCADE`로 종속의 관계로 설정하여 참조를 하고있는 대상이 삭제된다면 참조하고 있는 데이터가 함께 삭제되도록 하였다.

하지만 커머스사이트는 대체로(?) 특정 유저가 회원탈퇴를 하더라도 그 유저의 주문기록을 정해진 기간 동안 보존한다고 한다. 그런데 기존의 방식인 종속의 관계로 둔다면, 기록 관리에 어려움이 있다는 사실을 알았다.

처음에는 `on_delete=SET_NULL`의 방식을 채택하여 참조 중인 데이터가 삭제되더라도 데이터가 보존되도록 할려고 하였다. 그러면 주문 기록은 남지만 참조 중인 유저 정보가 다 삭제되므로 어떤 유저가 주문한 정보인지 알 수가 없었다.

그래서 생각한 방식은 아래와 같았다.

1. on_delete=models.PROTECT로 변경하여 참조를 받는 데이터를 삭제하지 못하게 변경
2. 기존의 참조를 받는 users 테이블에 회원 상태를 확인할 수 있는 column 추가(boolean type)
3. 회원 로그인 시 user 테이블의 회원 상태를 함께 검사하여 로그인이 되도록 로직 구성
4. 탈퇴한 회원정보와 구매정보는 법적인 보존기간이 지날 경우 자동으로 삭제되도록 설정

위의 방식대로 하면 회원탈퇴를 하더라도 유저정보가 그대로 남아있으니 주문 정보와 해당 주문을 한 유저 정보 또한 그대로 보존될 수 있다.

하지만 이는 나의 개인적인 생각일 뿐 문제가 많을 수 있다고 생각한다.  
이 점에 대해서는 추후 멘토님의 리뷰를 받아봐야 현실가능성을 알 수 있을듯 하다.
