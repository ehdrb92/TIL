# 인증과 인가

우리가 인터넷에서 특정 활동을 하려할 때 그곳에 접근하기 위해서 권한을 얻어야 할 때가 있다. 이에 대해 `인증`과 `인가`라는 두 가지의 헷갈리는 개념에 대해 알아보고, 관련된 기술에 대해 알아보도록 하겠다.

## 인증(Authentication)과 인가(Authorization)

`인증`은 어떤 사용자의 신원을 확인하는 과정이라고 볼 수 있다. 만약 우리가 쇼핑몰에서 쇼핑을 하고자 한다. 이때 여기서 '찜하기'와 같은 기능을 사용하려 하면 로그인을 하라는 메세지가 나오게 된다. 여기서 해당 기능을 사용하기 위해 우리의 아이디와 비밀번호를 입력하여 내가 이 쇼핑몰의 회원이라는 것을 증명하는 행위가 `인증`인 것이다.

`인가`는 신원 확인과정을 통해 권한을 얻는 행위 그 자체를 의미한다. 위의 예시에서 우리는 로그인을 하는 `인증`이라는 행위를 통하여 찜목록을 사용할 수 있게 되었다. 이와 같은 것을 `인가`라고 한다.

## Cookie, Session 그리고 JWT(Json Web Token)

우리가 웹 페이지에 로그인 하면 특정 권한을 얻게 된다. 그런데 HTTP가 `Stateless`라는 특징을 가지고 있어 웹 페이지는 우리가 인증과정을 이미 거쳤다는 것을 인지하지 못하고 권한이 필요한 다음 활동을 할 때마다 계속해서 인증을 하라고 한다. 하지만 우리는 현재 로그인을 한 번하면 특정 기간동안은 인증과 인가의 과정을 거친 상태로 지속한다. 이러한 편의성을 가질 수 있는 이유가 `Cookie, Session` 그리고 `JWT`라는 기술이 있기 때문이다.

### Cookie, Session

Cookie, Session은 원래 별개의 기술이지만 이 둘은 세트처럼 같이 붙어 사용되는 기술이라 묶어 생각해보도록 하겠다. 먼저 사용자가 로그인을 하게 되면 서버측은 해당 사용자의 로그인 기록을 가지기 위해 서버의 Session DB에 사용자의 Session 정보를 저장한다. 그리고 DB에 저장된 Session 정보와 대조해 볼 수 있는 몇 가지 Session 정보를 Cookie라는 저장매체에 담아 사용자에게 전달한다.
이후 사용자가 다른 페이지로 이동하면 사용자가 웹 페이지를 요청할 때 이전에 Session 정보를 담아 두었던 Cookie를 함께 전달한다. 그러면 서버는 Session DB에서 전달받은 Session 정보에 일치하는 데이터를 찾아내어 사용자가 권한이 있는 상태인지를 알게된다.

### JWT(Json Web Token)

JWT는 비슷하지만 다른 개념이다. 우선 사용자가 최초로 로그인을 하는 과정까지는 동일하다. 그런데 여기서 Session과 다르게 사용자에 대한 정보를 서버의 DB에 저장하지 않는다. 그리고 Cookie를 사용하지 않으며 대신에 JWT을 사용자에게 전달한다. JWT는 크게 Header, Payload, Signature로 구성되어 있다.
`Header`는 토큰의 타입과 서명 생성에 사용된 알고리즘에 대한 데이터가 포함된다. `Payload`에는 클레임(claim) 정보가 `{key : value}`의 형태로 포함된다. 여기서 클레임이란 사용자 또는 토큰에 대한 속성 정보라고 한다. `Signature`에는 해당 토큰이 자신의 서버에서 발행한 토큰이 맞는지 확인하기 위한 비밀키가 저장되어 있다.
사용자가 웹 페이지를 요청할 때 Cookie 대신 Token을 보낸다. 그러면 서버는 Signature 부분을 서버의 비밀키와 대조하고, 인증이 되면 Payload의 정보를 읽어 사용자를 판별한다.
