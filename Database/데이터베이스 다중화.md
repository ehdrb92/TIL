다중화란 같은 시스템을 가진 예비 장치를 준비하여 시스템의 일부분 장애가 발생하더라도 서비스를 유지할 수 있도록 하는 것이다.

간단히 병렬화하여 장비 수를 증가시키는 웹 서버나 애플리케이션 서버에 비하면 DB서버의 경우 문제점이 있다. 이는 DB 서버가 데이터를 보존하는 영속(persistence)계층이기 때문이다.

데이터베이스는 데이터를 장기간 보존하는 매체가 필요하다. 이 점은 데이터를 일시적으로 처리할 뿐인 웹 / 앱 서버와 다른 점이다. 데이터베이스는 대량의 데이터를 영구적으로 보존해야 하고 그에 따른 성능도 요구되기 때문에 데이터를 보존하는 매체에 필요한 요건이 높다. 일반적으로 서버 내부의 로컬 저장소나 메모리로는 요건을 충족시키지 못하기 때문에 전용 외부 저장소를 사용해야한다. 결국 DB 서버의 아키텍처는 서버와 저장소를 묶어서 생각해야 한다.

## 클러스터링(Clustring)

가장 기본적인 다중화 방식은 클러스터링이다. 기존의 데이터베이스 아키텍처는 하나의 DB 서버가 하나의 저장소를 관리한다. 이 때는 해당 DB 서버가 죽어버리면 서비스 전체가 중단되게 된다. 그래서 가장 간단한 방법으로 저장소는 그대로 두고 DB 서버를 두 개 이상 두는 방법이다. 이 경우 보존되는 저장소가 1개 이므로 정합성을 신경쓰지 않아도 된다.

클러스터링은 서버의 동시 가동 여부에 따라 2가지로 나뉜다.

* Active-Active: 클러스터를 구성하는 컴포넌트를 동시에 가동
* Active-Standby: 클러스터를 구성하는 컴포넌트 중 실제 가동하는 것은 Active, 나머지는 Standby

* Active-Active의 장단점

    * DB 서버가 여러 대라 1대에서 장애가 발생해도 처리를 계속 할 수 있다
    * DB 서버의 부하 분산: 나의 서버가 부담하던 부하를 두 개의 DB가 나눠서 감당하고, 각 DB 서버의 CPU나 메모리가 동시에 가동되므로 처리 성능이 향상된다

    * 저장소가 병목지점이 되어 생각만큼 성능 향상이 안 될 수 있다
    * 비용이 크다

* Active-Standby 특징 및 장단점

    Active-Standby는 내부적으로 두 가지 방식이 존재한다.

    * Cold-Standby: 평소에는 Standby DB가 작동하지 않다가 Active DB가 다운된 시점에 작동
    * Hot-Standby: 평소에도 Standby DB가 작동

    * Active-Active의 저장소 병목 현상이 해결된다

    * Failover(예비 시스템으로의 자동 전환)가 이뤄지는 전환시간(수십 초 ~ 수분) 동안에는 서비스가 불가능해진다.

## 리플리케이션(Replication)

리플리케이션(Replication)이란 DB 서버와 저장소를 세트로 하여 복수로 준비하는 것을 의미한다. 말 그대로 똑같은 것을 하나 복사 해놓는 것이다. 이 방식에서는 가동 중인 서버와 저장소를 Mastet DB, 복제된 쪽을 Slave DB라고 한다. Master DB로 작업을 하면 작업 결과가 Slave DB에 복제되게 된다. 그런데 이 때 Master DB만 작업을 하고 Slave DB가 놀게 된다는 단점을 보완하기 위해 생성, 수정, 삭제는 Master DB에서 하고, 조회 작업은 Slave DB에서 하여 서버 부하를 분산시킨다.

리플리케이션의 경우 서버가 죽는 상황에 대한 대비는 될 지라도 데이터가 많을 경우 검색 속도면에서 성능 향상을 기대할 수 없다는 단점이 있다. 이 때 사용하는 것이 Shared Nothing이다.

* Shared Nothing

복수의 서버가 한 개의 저장소를 공유하는 것을 Shared Disk라 하며 네트워크 이외의 자원을 아무것도 공유하지 않는 방식을 Shared Nothing 구조라 한다.

Shared Nothing에서는 DB 서버와 저장소로 구성된 세트를 늘려서 저장소가 병목 지점이 되는 것을 방지한다. Shared Nothing 구조로 샤딩이 있다. 하지만, 저장소를 공유하지 않는 것은 결국 ‘각각의 DB 서버가 동일한 1개의 데이터에 접근 할 수 없다’를 의미한다. 예로, 시 단위 ‘DB 서버 + 저장소’ 세트를 갖춘 Shared Nothing 구성에는 고양시 데이터를 가진 DB 서버가 접근할 수 있는 것은 고양시 데이터뿐이다. 때문에 시별 인구 데이터를 합산해서 경기도 인구를 계산하려는 경우 각 세트로부터 시별 인구를 모아서 집계하는 정리 서버가 필요하게 된다. 또한 고양시의 DB 서버가 다운되었을 때는 고양시 데이터에 접근 할 수 없는 문제가 발생한다.

이런 문제에 대처하려면 DB 서버 하나가 다운되었을 때 다른 DB 서버가 이를 이어 받아 계속 처리할 수 있게 하는 커버링(Covering) 구성 등을 고려해야한다.
